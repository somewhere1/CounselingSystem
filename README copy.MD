# å¿ƒç†å’¨è¯¢ç³»ç»Ÿ (Counseling System)

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Status](https://img.shields.io/badge/Status-Active-brightgreen.svg)]()

ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½å¿ƒç†å’¨è¯¢ç³»ç»Ÿï¼Œæ”¯æŒæ‚£è€…-å’¨è¯¢å¸ˆå¯¹è¯æ¨¡æ‹Ÿã€CBTè®¤çŸ¥è¡Œä¸ºç–—æ³•ã€æ¨ç†è¯„ä¼°ç­‰åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºè®¿é—®AIæ¨¡å‹APIï¼‰

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd roleplay2

# å®‰è£…ä¾èµ–
pip install openai zhipuai pathlib dataclasses typing
```

### é…ç½®APIå¯†é’¥

æœ‰ä¸¤ç§æ–¹å¼é…ç½®APIå¯†é’¥ï¼š

#### æ–¹å¼1ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
```bash
# Windows
set ZHIPU_API_KEY=your_zhipu_api_key
set QWEN_API_KEY=your_qwen_api_key
set MOONSHOT_API_KEY=your_moonshot_api_key

# Linux/Mac
export ZHIPU_API_KEY=your_zhipu_api_key
export QWEN_API_KEY=your_qwen_api_key
export MOONSHOT_API_KEY=your_moonshot_api_key
```

#### æ–¹å¼2ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶
ç¼–è¾‘ `refactored_counseling_system/config.py` æ–‡ä»¶ï¼Œç›´æ¥ä¿®æ”¹APIå¯†é’¥ï¼š

```python
@dataclass
class APIConfig:
    ZHIPU_API_KEY: str = "your_zhipu_api_key"
    QWEN_API_KEY: str = "your_qwen_api_key"
    MOONSHOT_API_KEY: str = "your_moonshot_api_key"
    # ...
```

### å¿«é€Ÿè¿è¡Œ

```bash
# è¿è¡Œç¤ºä¾‹ç¨‹åº
python example_usage.py
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨æŒ‡å—

### 1. è¿è¡Œå•ä¸ªå’¨è¯¢ä¼šè¯

```python
from refactored_counseling_system import ConversationSession, ConversationMode

# å®šä¹‰æ‚£è€…ä¿¡æ¯
patient_info = """
æ‚£è€…ï¼šå¼ ä¸‰
å¹´é¾„ï¼š28å²
ä¸»è¦é—®é¢˜ï¼šå·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸æ„Ÿåˆ°ç„¦è™‘
ç—‡çŠ¶ï¼šå¤±çœ ã€æ³¨æ„åŠ›ä¸é›†ä¸­ã€æƒ…ç»ªä½è½
æŒç»­æ—¶é—´ï¼š3ä¸ªæœˆ
èƒŒæ™¯ï¼šè½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæœ€è¿‘é¡¹ç›®å‹åŠ›å¤§
"""

# åˆ›å»ºä¼šè¯
session = ConversationSession(
    patient_info=patient_info,
    is_first_session=True,  # æ˜¯å¦ä¸ºé¦–æ¬¡ä¼šè¯
    conversation_mode=ConversationMode.PATIENT_FIRST  # æ‚£è€…å…ˆè¯´è¯
)

# è¿è¡Œå®Œæ•´ä¼šè¯
results = session.run_full_session()

# æŸ¥çœ‹ç»“æœ
print(f"ä¼šè¯å®Œæˆï¼Œå…±è¿›è¡Œäº† {results['statistics']['total_turns']} è½®å¯¹è¯")
print(f"æ¨ç†è¯„ä¼°æ¬¡æ•°ï¼š{len(results['session_data']['reasoning_history'])}")
```

### 2. æ‰¹é‡å¤„ç†æ‚£è€…æ¡£æ¡ˆ

```python
from refactored_counseling_system import CounselingSystemApp

# åˆå§‹åŒ–åº”ç”¨
app = CounselingSystemApp()

# æ‰¹é‡å¤„ç†æ–‡ä»¶å¤¹ä¸­çš„æ‚£è€…æ¡£æ¡ˆ
results = app.process_patient_folder(
    folder_path="Original_Profile",  # æ‚£è€…æ¡£æ¡ˆæ–‡ä»¶å¤¹
    is_first_session=True,
    conversation_mode=ConversationMode.PATIENT_FIRST
)

print(f"å¤„ç†ç»“æœï¼š")
print(f"- æ€»æ–‡ä»¶æ•°ï¼š{results['total_files']}")
print(f"- æˆåŠŸå¤„ç†ï¼š{results['processed']}")
print(f"- è·³è¿‡æ–‡ä»¶ï¼š{results['skipped']}")
print(f"- é”™è¯¯æ–‡ä»¶ï¼š{results['errors']}")
```

### 3. ç”ŸæˆCBTè®¤çŸ¥æ¨¡å‹

```python
# ä»å¯¹è¯æ–‡ä»¶ç”ŸæˆCBTè®¤çŸ¥æ¨¡å‹
cbt_results = app.generate_cbt_models(
    dialogue_folder="Adialogue_files",           # å¯¹è¯æ–‡ä»¶å¤¹
    with_suggestion_path="Awith_suggestion",     # åŒ…å«å»ºè®®çš„CBTæ¨¡å‹
    half_suggestion_path="Ahalf_suggestion",     # éƒ¨åˆ†å»ºè®®çš„CBTæ¨¡å‹
    without_suggestion_path="Awithout_suggestion" # ä¸å«å»ºè®®çš„CBTæ¨¡å‹
)

print(f"CBTæ¨¡å‹ç”Ÿæˆå®Œæˆï¼š{cbt_results['processed']} ä¸ªæ–‡ä»¶")
```

### 4. ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

```python
# éªŒè¯ç³»ç»Ÿé…ç½®
validation = app.validate_system()
if validation["overall_status"]:
    print("âœ… ç³»ç»Ÿé…ç½®æ­£ç¡®ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œ")
else:
    print("âŒ ç³»ç»Ÿé…ç½®æœ‰é—®é¢˜ï¼š")
    print(f"  é…ç½®éªŒè¯ï¼š{validation['config_valid']}")
    print(f"  LLMè¿æ¥ï¼š{validation['llm_connections']}")
    print(f"  ç›®å½•æ£€æŸ¥ï¼š{validation['directories_ok']}")

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
status = app.get_system_status()
print(f"ç³»ç»ŸçŠ¶æ€ï¼š{status}")
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `MAX_DIALOGUE_LENGTH` | 70 | æœ€å¤§å¯¹è¯è½®æ•° |
| `MAX_MODIFICATION_ATTEMPTS` | 4 | æœ€å¤§ä¿®æ”¹å°è¯•æ¬¡æ•° |
| `SUMMARY_START_SIZE` | 13 | å¼€å§‹æ‘˜è¦çš„å¯¹è¯è½®æ•° |
| `SUMMARY_BUFFER_SIZE` | 6 | æ‘˜è¦ç¼“å†²åŒºå¤§å° |
| `DEFAULT_TEMPERATURE` | 0.8 | é»˜è®¤æ¨¡å‹æ¸©åº¦ |
| `REASONING_TEMPERATURE` | 0.9 | æ¨ç†æ¨¡å‹æ¸©åº¦ |

### æ¨¡å‹é…ç½®

ç³»ç»Ÿæ”¯æŒå¤šç§AIæ¨¡å‹ï¼š

- **Qwenç³»åˆ—**: `qwen-plus`, `qwen-max`
- **DeepSeek**: `deepseek-r1` (ç”¨äºæ¨ç†)
- **Moonshot**: `moonshot-v1-8k`
- **OpenAI**: é€šè¿‡ä»£ç†è®¿é—®

### ç›®å½•ç»“æ„

```
roleplay2/
â”œâ”€â”€ refactored_counseling_system/    # é‡æ„åçš„ç³»ç»Ÿ
â”‚   â”œâ”€â”€ config.py                    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ prompts.py                   # æç¤ºè¯ç®¡ç†
â”‚   â”œâ”€â”€ llm_client.py               # AIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ dialogue_manager.py         # å¯¹è¯ç®¡ç†
â”‚   â”œâ”€â”€ reasoning_engine.py         # æ¨ç†å¼•æ“
â”‚   â”œâ”€â”€ agents.py                   # ä»£ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ file_utils.py               # æ–‡ä»¶å·¥å…·
â”‚   â””â”€â”€ main.py                     # ä¸»ç¨‹åº
â”œâ”€â”€ Original_Profile/               # åŸå§‹æ‚£è€…æ¡£æ¡ˆ
â”œâ”€â”€ Adialogue_files/               # å¯¹è¯æ–‡ä»¶
â”œâ”€â”€ Awith_suggestion/              # åŒ…å«å»ºè®®çš„CBTæ¨¡å‹
â”œâ”€â”€ Ahalf_suggestion/              # éƒ¨åˆ†å»ºè®®çš„CBTæ¨¡å‹
â”œâ”€â”€ Awithout_suggestion/           # ä¸å«å»ºè®®çš„CBTæ¨¡å‹
â”œâ”€â”€ example_usage.py               # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ B.py                          # åŸå§‹ç³»ç»Ÿæ–‡ä»¶
â””â”€â”€ README.md                     # æœ¬æ–‡æ¡£
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„AIæ¨¡å‹

1. åœ¨ `config.py` ä¸­æ·»åŠ æ¨¡å‹é…ç½®
2. åœ¨ `llm_client.py` ä¸­æ·»åŠ å®¢æˆ·ç«¯æ”¯æŒ
3. æ›´æ–°æ¨¡å‹è·¯ç”±é€»è¾‘

### è‡ªå®šä¹‰æç¤ºè¯

ç¼–è¾‘ `prompts.py` æ–‡ä»¶ï¼Œä¿®æ”¹æˆ–æ·»åŠ æ–°çš„æç¤ºè¯æ¨¡æ¿ï¼š

```python
class PromptTemplates:
    # æ·»åŠ æ–°çš„æç¤ºè¯æ¨¡æ¿
    YOUR_CUSTOM_PROMPT = """
    ä½ çš„è‡ªå®šä¹‰æç¤ºè¯å†…å®¹...
    """
```

### æ‰©å±•ä»£ç†åŠŸèƒ½

åœ¨ `agents.py` ä¸­ç»§æ‰¿åŸºç±»åˆ›å»ºæ–°çš„ä»£ç†ï¼š

```python
class CustomAgent(BaseAgent):
    def generate_response(self, dialogue_manager, context=None):
        # å®ç°è‡ªå®šä¹‰é€»è¾‘
        pass
```

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

- [x] å¤šè½®å¯¹è¯ç®¡ç†
- [x] R1æ¨ç†è¯„ä¼°
- [x] CBTè®¤çŸ¥æ¨¡å‹ç”Ÿæˆ
- [x] æ‰¹é‡æ–‡ä»¶å¤„ç†
- [x] è‡ªåŠ¨æ‘˜è¦ç”Ÿæˆ
- [x] é…ç½®ç®¡ç†
- [x] é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [x] ä¼šè¯æ•°æ®æŒä¹…åŒ–

### ğŸ”„ è®¡åˆ’ä¸­åŠŸèƒ½

- [ ] Webç•Œé¢
- [ ] æ•°æ®åº“é›†æˆ
- [ ] å®æ—¶ç›‘æ§é¢æ¿
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] RESTful API
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

## ğŸ› å¸¸è§é—®é¢˜

### 1. APIè¿æ¥å¤±è´¥

**é—®é¢˜**ï¼šæç¤ºAPIå¯†é’¥é”™è¯¯æˆ–è¿æ¥è¶…æ—¶

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
python -c "from refactored_counseling_system import config; print(config.api.QWEN_API_KEY)"

# éªŒè¯ç½‘ç»œè¿æ¥
python -c "from refactored_counseling_system import CounselingSystemApp; app = CounselingSystemApp(); print(app.validate_system())"
```

### 2. æ–‡ä»¶è·¯å¾„é”™è¯¯

**é—®é¢˜**ï¼šæ‰¾ä¸åˆ°æ‚£è€…æ¡£æ¡ˆæ–‡ä»¶

**è§£å†³æ–¹æ³•**ï¼š
```python
import os
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
folder_path = "Original_Profile"
if os.path.exists(folder_path):
    files = os.listdir(folder_path)
    print(f"æ‰¾åˆ° {len(files)} ä¸ªæ–‡ä»¶")
else:
    print("æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥è·¯å¾„")
```

### 3. æ¨¡å‹å“åº”å¼‚å¸¸

**é—®é¢˜**ï¼šAIæ¨¡å‹è¿”å›æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥æ¨¡å‹é…ç½®å’Œæ¸©åº¦è®¾ç½®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
- å°è¯•é™ä½æ¸©åº¦å‚æ•°

### 4. å†…å­˜ä½¿ç”¨è¿‡é«˜

**é—®é¢˜**ï¼šå¤„ç†å¤§é‡æ–‡ä»¶æ—¶å†…å­˜å ç”¨è¿‡é«˜

**è§£å†³æ–¹æ³•**ï¼š
- å‡å°‘ `SUMMARY_BUFFER_SIZE` å‚æ•°
- åˆ†æ‰¹å¤„ç†æ–‡ä»¶
- å¢åŠ ç³»ç»Ÿå†…å­˜

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/æ–°åŠŸèƒ½`)
3. æäº¤æ›´æ”¹ (`git commit -am 'æ·»åŠ æ–°åŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/æ–°åŠŸèƒ½`)
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª PEP 8 ä»£ç é£æ ¼
- æ·»åŠ é€‚å½“çš„ç±»å‹æç¤º
- ç¼–å†™æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
- æ·»åŠ å¿…è¦çš„å•å…ƒæµ‹è¯•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- åˆ›å»º Issue
- å‘é€é‚®ä»¶è‡³ï¼š[your-email@example.com]
- é¡¹ç›®ä¸»é¡µï¼š[https://github.com/your-username/counseling-system]

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¿«é€Ÿæµ‹è¯•ç³»ç»Ÿï¼š

```bash
# æµ‹è¯•ç³»ç»Ÿé…ç½®
python -c "
from refactored_counseling_system import CounselingSystemApp
app = CounselingSystemApp()
result = app.validate_system()
print('ç³»ç»ŸçŠ¶æ€:', 'âœ… æ­£å¸¸' if result['overall_status'] else 'âŒ å¼‚å¸¸')
print('è¯¦ç»†ä¿¡æ¯:', result)
"

# è¿è¡Œå®Œæ•´ç¤ºä¾‹
python example_usage.py
```

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„è¾“å‡ºä¿¡æ¯ã€‚

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰